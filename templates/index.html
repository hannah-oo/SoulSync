<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <style>
      #map {position: absolute; top: 0; right: 0; bottom: 0; left: 0;        width: 100vw;
        height: 100vh;}
        #map-container {
        position: relative;
        width: 80vw; /* Adjust width as needed */
        height: 80vh; /* Adjust height as needed */
        margin: 20px auto; /* Center the div horizontally */
        border: 2px solid #ccc; /* Optional: border for visibility */
      }
      .circle-label {
        background: lightblue;
        border-radius: 50%;
        color: black;
        text-align: center;
        line-height: 28px; /* Adjust this to vertically center the text */
        width: 30px; /* Initial size of the circle */
        height: 30px; /* Initial size of the circle */
        font-size: 14px; /* Font size */
        font-weight: bold;
        /* border: 2px solid black; Circle border */
        box-shadow: 0 0 5px rgba(0,0,0,0.5); /* Optional shadow */
      }
    </style>
  </head>
  <body>

        <div id="map">
            <a href="https://www.maptiler.com" style="position:absolute;left:10px;bottom:10px;z-index:999;"><img src="https://api.maptiler.com/resources/logo.svg" alt="MapTiler logo"></a>
          </div>
 
    <p><a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a></p>
    <script>
      var map = L.map('map').setView([0, 0], 2.5);
      L.tileLayer('https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=Rb6RSlyQw3mhvmyU4sF3',{
        tileSize: 512,
        zoomOffset: -1,
        minZoom: 2,
        attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
        crossOrigin: true
      }).addTo(map);




      // Optional: Disable vertical zooming beyond certain latitudes (to prevent map from moving vertically when zooming)
      var southWest = L.latLng(-85, -Infinity);
      var northEast = L.latLng(85, Infinity);
      var bounds = L.latLngBounds(southWest, northEast);
      map.setMaxBounds(bounds);

      fetch('/coordinates')
        .then(response => response.json())
        .then(data => {
          data.forEach(item => {
            // Create a circle with dynamic radius based on zoom level

            // Create a div for the label
            var labelDiv = document.createElement('div');
            labelDiv.className = 'circle-label';
            labelDiv.innerHTML = item.number;
            var size = 20 + (item.number * 5); // Base size + scaling factor per number
            labelDiv.style.width = size + 'px';
            labelDiv.style.height = size + 'px';
            labelDiv.style.lineHeight = size + 'px'; // Center text vertically
            labelDiv.style.fontSize = (size / 3) + 'px';
            // Create a custom icon for the label
            var customIcon = L.divIcon({
              className: '',
              html: labelDiv.outerHTML,
              iconSize: [size, size] // Size of the icon
            });

            // Create a marker with the custom icon
            L.marker([item.lat, item.lon], {icon: customIcon}).addTo(map);

            // Adjust the circle and label size based on zoom level
            map.on('zoom', function() {
              var zoom = map.getZoom();
              var radius = calculateRadius(item.number, zoom); // Adjust radius based on zoom level
              circle.setRadius(radius);

              // Adjust label size based on zoom level
              var size = 20 + zoom; // Adjust label size
              labelDiv.style.width = size + 'px';
              labelDiv.style.height = size + 'px';
              labelDiv.style.lineHeight = size + 'px';
              labelDiv.style.fontSize = (size / 2) + 'px'; // Font size relative to circle size
            });
          });
        })
        .catch(error => console.error('Error loading coordinates:', error));
      function calculateRadius(number, zoom) {
        var baseRadius = 50; // Base radius in pixels
        var scaleFactor = 5; // Scale factor for the number
        var zoomFactor = 0.5; // Zoom factor to adjust the radius with zoom level

        // Adjust radius: larger number means larger size, and zoom level affects size
        return baseRadius + (number * scaleFactor) / (zoom * zoomFactor);
      }
    </script>
  </body>
</html>